import{k as e,l as t,g as i,s as r,m as s,c as o,w as a,d as n,i as c,o as l,a as d,e as g,r as u,F as m,b as y,t as h,p,h as f,f as v,S as P,q as k,u as b}from"./index-BDtgVNeI.js";import{C as _}from"./CustomNavBar.DdiFadKl.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";let R=null,S=null;function C(){return R||(R=e(),R.onError((e=>{console.error("Audio error:",e)}))),R}function I(){return S||(S=t()),S}const T={playBgm:function(e){const t=C();t.src=e,t.play()},pause:function(){R&&R.pause()},stop:function(){R&&R.stop()},resume:function(){R&&R.play()},seek:function(e){R&&R.seek(e)},getCurrentTime:function(){return R?R.currentTime:0},getDuration:function(){return R?R.duration:0},onAudioEvent:function(e,t){switch(R||C(),e){case"play":R.onPlay(t);break;case"pause":R.onPause(t);break;case"stop":R.onStop(t);break;case"ended":R.onEnded(t);break;case"timeUpdate":R.onTimeUpdate(t);break;case"error":R.onError(t)}},startRecord:function(){return new Promise(((e,t)=>{const i=I();i.onStart((()=>{e()})),i.onError((e=>{console.error("Recorder error:",e),t(e)})),i.start({duration:6e5,sampleRate:44100,numberOfChannels:1,encodeBitRate:128e3,format:"mp3"})}))},stopRecord:function(){return new Promise(((e,t)=>{const i=I();i.onStop((t=>{e({tempFilePath:t.tempFilePath,duration:Math.round(t.duration/1e3)})})),i.onError((e=>{t(e)})),i.stop()}))},playRecord:function(e){const t=C();t.src=e,t.play()},onRecordEvent:function(e,t){const i=I();switch(e){case"start":i.onStart(t);break;case"stop":i.onStop(t);break;case"pause":i.onPause(t);break;case"resume":i.onResume(t);break;case"error":i.onError(t);break;case"frameRecorded":i.onFrameRecorded(t)}},destroy:function(){R&&(R.destroy(),R=null)}},L=[{id:"love",name:"æƒ…æ­Œå¯¹å”±",icon:"ðŸ’•",description:"è¡¨è¾¾çˆ±æ„çš„å±±æ­Œ"},{id:"folk",name:"æ°‘ä¿—å±±æ­Œ",icon:"ðŸ”ï¸",description:"ä¼ ç»Ÿå£®æ—æ°‘ä¿—æ­Œæ›²"},{id:"festival",name:"èŠ‚åº†å±±æ­Œ",icon:"ðŸŽ‰",description:"èŠ‚æ—¥åº†å…¸æ­Œæ›²"},{id:"labor",name:"åŠ³åŠ¨å±±æ­Œ",icon:"ðŸŒ¾",description:"åŠ³ä½œæ—¶å”±çš„å±±æ­Œ"}],w=[{id:"song-1",categoryId:"love",title:"å±±æ­Œå¥½æ¯”æ˜¥æ±Ÿæ°´",artist:"å£®æ—æ°‘æ­Œ",duration:180,bgmUrl:"/static/audio/song1.mp3",lyrics:[{time:0,text:"å±±æ­Œå¥½æ¯”æ˜¥æ±Ÿæ°´"},{time:5e3,text:"ä¸æ€•æ»©é™©å¼¯åˆå¤š"},{time:1e4,text:"å¼¯å¼¯æ›²æ›²éƒ½ç»è¿‡"},{time:15e3,text:"è¿˜æœ‰é‚£æƒ…æ­Œä¸‡ä¸‡åƒ"}],coverImage:"/static/images/song1.jpg"},{id:"song-2",categoryId:"love",title:"åˆ˜ä¸‰å§",artist:"å£®æ—æ°‘æ­Œ",duration:210,bgmUrl:"/static/audio/song2.mp3",lyrics:[{time:0,text:"å”±å±±æ­Œå’§"},{time:3e3,text:"è¿™è¾¹å”±æ¥é‚£è¾¹å’Œ"},{time:8e3,text:"å±±æ­Œå¥½æ¯”æ˜¥æ±Ÿæ°´"},{time:13e3,text:"ä¸æ€•æ»©é™©å¼¯åˆå¤š"}],coverImage:"/static/images/song2.jpg"},{id:"song-3",categoryId:"folk",title:"å£®ä¹¡ç¾Ž",artist:"å£®æ—æ°‘æ­Œ",duration:195,bgmUrl:"/static/audio/song3.mp3",lyrics:[{time:0,text:"å£®ä¹¡ç¾Žå¦‚ç”»"},{time:5e3,text:"å±±æ¸…æ°´ç§€äººæ›´ç¾Ž"},{time:1e4,text:"æ­Œå£°é£˜å››æ–¹"}],coverImage:"/static/images/song3.jpg"},{id:"song-4",categoryId:"folk",title:"èµ¶åœ©å½’æ¥å•Šå“©å“©",artist:"å£®æ—æ°‘æ­Œ",duration:165,bgmUrl:"/static/audio/song4.mp3",lyrics:[{time:0,text:"èµ¶åœ©å½’æ¥å•Šå“©å“©"},{time:4e3,text:"èµ¶åœ©å½’æ¥å•Šå“©å“©"},{time:8e3,text:"èº«ä¸ŠèƒŒç€ç«¹èƒŒç¯“"}],coverImage:"/static/images/song4.jpg"},{id:"song-5",categoryId:"festival",title:"ä¸‰æœˆä¸‰",artist:"å£®æ—æ°‘æ­Œ",duration:200,bgmUrl:"/static/audio/song5.mp3",lyrics:[{time:0,text:"ä¸‰æœˆä¸‰æ¥æ­Œæ»¡å¤©"},{time:5e3,text:"å£®å®¶å„¿å¥³é½æ¬¢å”±"},{time:1e4,text:"å±±æ­Œé£˜è¿‡ä¹é‡å±±"}],coverImage:"/static/images/song5.jpg"},{id:"song-6",categoryId:"festival",title:"æ¬¢åº¦ä½³èŠ‚",artist:"å£®æ—æ°‘æ­Œ",duration:175,bgmUrl:"/static/audio/song6.mp3",lyrics:[{time:0,text:"ä½³èŠ‚åˆ°æ¥å–œæ´‹æ´‹"},{time:5e3,text:"å£®ä¹¡å¤„å¤„æ­Œå£°æ‰¬"}],coverImage:"/static/images/song6.jpg"},{id:"song-7",categoryId:"labor",title:"æ’ç§§æ­Œ",artist:"å£®æ—æ°‘æ­Œ",duration:150,bgmUrl:"/static/audio/song7.mp3",lyrics:[{time:0,text:"æ˜¥é£Žå¹æ¥æ’ç§§å¿™"},{time:5e3,text:"å¼¯è…°æ’ç§§æ­Œå£°æ‰¬"}],coverImage:"/static/images/song7.jpg"},{id:"song-8",categoryId:"labor",title:"ä¸°æ”¶æ­Œ",artist:"å£®æ—æ°‘æ­Œ",duration:185,bgmUrl:"/static/audio/song8.mp3",lyrics:[{time:0,text:"é‡‘ç§‹æ—¶èŠ‚ç¨»è°·é¦™"},{time:5e3,text:"ä¸°æ”¶å–œæ‚¦æ»¡å±±ä¹¡"}],coverImage:"/static/images/song8.jpg"}];const D=x({components:{CustomNavBar:_},data:()=>({statusBarHeight:20,navPaddingTop:140,categories:L,selectedCategory:"love",songs:w,selectedSong:null,isPlaying:!1,isRecording:!1,recordingPath:"",recordingDuration:0,currentLyric:"",currentLyricIndex:-1,recordingTimer:null,currentPlayTime:0}),computed:{filteredSongs(){return e=this.songs,(t=this.selectedCategory)&&""!==t?e.filter((e=>e.categoryId===t)):e;var e,t},playProgress(){return this.selectedSong&&this.selectedSong.duration?this.currentPlayTime/this.selectedSong.duration*100:0}},onLoad(){const e=i().statusBarHeight||20;this.statusBarHeight=e,this.navPaddingTop=e+75,this.setupAudioListeners()},onUnload(){this.cleanup()},methods:{selectCategory(e){this.selectedCategory=e,this.selectedSong=null,this.isPlaying=!1,this.currentLyric=""},selectSong(e){this.isPlaying&&T.stop(),this.selectedSong=e,this.isPlaying=!1,this.recordingPath="",this.recordingDuration=0,this.currentLyric="",this.currentLyricIndex=-1,this.currentPlayTime=0},setupAudioListeners(){T.onAudioEvent("timeUpdate",(()=>{this.updateLyric()})),T.onAudioEvent("ended",(()=>{this.isPlaying=!1,this.currentLyric="",this.currentLyricIndex=-1})),T.onAudioEvent("error",(e=>{console.error("Audio playback error:",e),this.isPlaying=!1,r({title:"éŸ³é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}))},togglePlay(){this.selectedSong&&(this.isPlaying?(T.pause(),this.isPlaying=!1):(T.playBgm(this.selectedSong.bgmUrl),this.isPlaying=!0))},updateLyric(){if(!this.selectedSong||!this.selectedSong.lyrics)return;const e=1e3*T.getCurrentTime();this.currentPlayTime=T.getCurrentTime();const t=this.selectedSong.lyrics;for(let i=t.length-1;i>=0;i--)if(e>=t[i].time){this.currentLyricIndex!==i&&(this.currentLyricIndex=i,this.currentLyric=t[i].text);break}},async toggleRecording(){this.isRecording?await this.stopRecordingHandler():await this.startRecordingHandler()},async startRecordingHandler(){try{await T.startRecord(),this.isRecording=!0,this.recordingDuration=0,this.recordingPath="",this.recordingTimer=setInterval((()=>{this.recordingDuration++}),1e3)}catch(e){console.error("Failed to start recording:",e),r({title:"å½•éŸ³å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥éº¦å…‹é£Žæƒé™",icon:"none"})}},async stopRecordingHandler(){try{this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null);const e=await T.stopRecord();this.isRecording=!1,this.recordingPath=e.tempFilePath,this.recordingDuration=e.duration,r({title:"å½•éŸ³å®Œæˆ",icon:"success"})}catch(e){console.error("Failed to stop recording:",e),this.isRecording=!1,r({title:"å½•éŸ³ä¿å­˜å¤±è´¥",icon:"none"})}},previewRecording(){this.recordingPath?T.playRecord(this.recordingPath):r({title:"æ²¡æœ‰å¯é¢„è§ˆçš„å½•éŸ³",icon:"none"})},reRecord(){this.recordingPath="",this.recordingDuration=0},submitRecording(){const e=(t=this.selectedSong,i=this.recordingPath,t?i&&""!==i?{valid:!0,message:"éªŒè¯é€šè¿‡"}:{valid:!1,message:"è¯·å…ˆå½•åˆ¶æ‚¨çš„æ­Œå£°"}:{valid:!1,message:"è¯·å…ˆé€‰æ‹©ä¸€é¦–æ­Œæ›²"});var t,i;return e.valid?(r({title:"æäº¤æˆåŠŸ",icon:"success"}),this.recordingPath="",this.recordingDuration=0,{success:!0,message:"æäº¤æˆåŠŸ"}):(r({title:e.message,icon:"none"}),{success:!1,message:e.message})},formatDuration:e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,cleanup(){this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null),T.stop(),T.destroy()}}},[["render",function(e,t,i,r,_,x){const R=s("custom-nav-bar"),S=v,C=c,I=P,T=b,L=k;return l(),o(C,{class:"online-duet-container",style:n({paddingTop:_.navPaddingTop+"px"})},{default:a((()=>[d(R,{title:"çº¿ä¸Šå±±æ­Œå¯¹å”±",gradient:"linear-gradient(120deg, #1b5e20 0%, #2e7d32 45%, #43a047 100%)"}),d(C,{class:"categories"},{default:a((()=>[d(I,{"scroll-x":"",class:"category-scroll"},{default:a((()=>[(l(!0),g(m,null,u(_.categories,(e=>(l(),o(C,{key:e.id,class:f(["category-item",{active:_.selectedCategory===e.id}]),onClick:t=>x.selectCategory(e.id)},{default:a((()=>[d(S,null,{default:a((()=>[y(h(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),d(C,{class:"song-list"},{default:a((()=>[(l(!0),g(m,null,u(x.filteredSongs,(e=>(l(),o(C,{key:e.id,class:f(["song-item",{selected:_.selectedSong&&_.selectedSong.id===e.id}]),onClick:t=>x.selectSong(e)},{default:a((()=>[d(T,{src:e.coverImage,class:"song-cover",mode:"aspectFill"},null,8,["src"]),d(C,{class:"song-info"},{default:a((()=>[d(S,{class:"song-title"},{default:a((()=>[y(h(e.title),1)])),_:2},1024),d(S,{class:"song-artist"},{default:a((()=>[y(h(e.artist),1)])),_:2},1024)])),_:2},1024),d(S,{class:"song-duration"},{default:a((()=>[y(h(x.formatDuration(e.duration)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),_.selectedSong?(l(),o(C,{key:0,class:"control-panel"},{default:a((()=>[d(C,{class:"now-playing"},{default:a((()=>[d(S,{class:"playing-title"},{default:a((()=>[y(h(_.selectedSong.title),1)])),_:1}),d(C,{class:"play-controls"},{default:a((()=>[d(L,{class:"control-btn",onClick:x.togglePlay},{default:a((()=>[y(h(_.isPlaying?"â¸":"â–¶"),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),_.selectedSong.lyrics&&_.selectedSong.lyrics.length?(l(),o(C,{key:0,class:"lyrics-area"},{default:a((()=>[d(C,{class:"progress-bar"},{default:a((()=>[d(C,{class:"progress-fill",style:n({width:x.playProgress+"%"})},null,8,["style"])])),_:1}),d(S,{class:"current-lyric"},{default:a((()=>[y(h(_.currentLyric||"â™ª å‡†å¤‡æ’­æ”¾ â™ª"),1)])),_:1}),d(S,{class:"play-time"},{default:a((()=>[y(h(x.formatDuration(Math.floor(_.currentPlayTime)))+" / "+h(x.formatDuration(_.selectedSong.duration)),1)])),_:1})])),_:1})):p("",!0),d(C,{class:"record-panel"},{default:a((()=>[_.isRecording?(l(),o(C,{key:0,class:"record-status"},{default:a((()=>[d(S,{class:"recording-indicator"},{default:a((()=>[y("â— å½•éŸ³ä¸­")])),_:1}),d(S,{class:"recording-duration"},{default:a((()=>[y(h(x.formatDuration(_.recordingDuration)),1)])),_:1})])),_:1})):p("",!0),d(C,{class:"record-buttons"},{default:a((()=>[d(L,{class:f(["record-btn",{recording:_.isRecording}]),onClick:x.toggleRecording},{default:a((()=>[y(h(_.isRecording?"åœæ­¢å½•éŸ³":"å¼€å§‹å½•éŸ³"),1)])),_:1},8,["class","onClick"]),_.recordingPath?(l(),o(L,{key:0,class:"preview-btn",onClick:x.previewRecording},{default:a((()=>[y(" é¢„è§ˆå½•éŸ³ ")])),_:1},8,["onClick"])):p("",!0),_.recordingPath?(l(),o(L,{key:1,class:"rerecord-btn",onClick:x.reRecord},{default:a((()=>[y(" é‡å½• ")])),_:1},8,["onClick"])):p("",!0),_.recordingPath?(l(),o(L,{key:2,class:"submit-btn",onClick:x.submitRecording},{default:a((()=>[y(" æäº¤ä½œå“ ")])),_:1},8,["onClick"])):p("",!0)])),_:1})])),_:1})])),_:1})):(l(),o(C,{key:1,class:"empty-tip"},{default:a((()=>[d(S,null,{default:a((()=>[y("è¯·é€‰æ‹©ä¸€é¦–æ­Œæ›²å¼€å§‹å¯¹å”±")])),_:1})])),_:1}))])),_:1},8,["style"])}],["__scopeId","data-v-a038c37a"]]);export{D as default};
