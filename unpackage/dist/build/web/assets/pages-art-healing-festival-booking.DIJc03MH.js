import{g as a,s as e,n as t,m as l,c as s,w as o,d as i,i as n,o as r,a as c,b as d,e as f,r as m,F as u,v,t as p,p as _,h,f as g,q as k,I as F,x as b,u as D}from"./index-BDtgVNeI.js";import{C}from"./CustomNavBar.DdiFadKl.js";import{A as y}from"./art-booking.service.BvrYlACJ.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./storage.service.D1zc2f4B.js";const T=B({components:{CustomNavBar:C},data:()=>({navPaddingTop:100,festivals:[],selectedFestival:null,showBookingForm:!1,showConfirmation:!1,loading:!0,confirmationData:{festivalTitle:"",festivalDate:"",festivalTime:"",festivalLocation:"",name:"",phone:"",participants:1},formData:{name:"",phone:"",participants:1,remark:""},formErrors:{}}),onLoad(){const e=a();this.navPaddingTop=(e.statusBarHeight||20)+75,this.loadFestivals()},methods:{async loadFestivals(){this.loading=!0;try{this.festivals=await y.getFestivals()}catch(a){console.error("Failed to load festivals:",a),e({title:"åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{this.loading=!1}},goToRecords(){t({url:"/pages/art-healing/booking-records"})},openBookingForm(a){this.selectedFestival=a,this.showBookingForm=!0,this.resetForm()},closeBookingForm(){this.showBookingForm=!1,this.selectedFestival=null,this.resetForm()},resetForm(){this.formData={name:"",phone:"",participants:1,remark:""},this.formErrors={}},validateForm(){const a=y.validateArtBookingForm(this.formData),e={};return a.valid||a.errors.forEach((a=>{e[a.field]=a.message})),this.formErrors=e,a.valid},closeConfirmation(){this.showConfirmation=!1,this.confirmationData={festivalTitle:"",festivalDate:"",festivalTime:"",festivalLocation:"",name:"",phone:"",participants:1}},goToRecordsFromConfirm(){this.closeConfirmation(),this.goToRecords()},async submitBooking(){if(!this.validateForm())return;if(!this.selectedFestival)return void e({title:"è¯·é€‰æ‹©æ´»åŠ¨",icon:"none"});const a=await y.createArtBooking(this.selectedFestival.id,this.selectedFestival,this.formData);if(a.success){const a=this.festivals.findIndex((a=>a.id===this.selectedFestival.id));-1!==a&&(this.festivals[a].availableSlots-=this.formData.participants||1),this.confirmationData={festivalTitle:this.selectedFestival.title,festivalDate:this.selectedFestival.date,festivalTime:this.selectedFestival.time,festivalLocation:this.selectedFestival.location,name:this.formData.name,phone:this.formData.phone,participants:this.formData.participants||1},this.showBookingForm=!1,this.showConfirmation=!0,this.selectedFestival=null,this.resetForm()}else e({title:a.message||"é¢„çº¦å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}}},[["render",function(a,e,t,C,y,B){const T=l("custom-nav-bar"),w=g,x=n,V=D,E=k,S=F,j=b;return r(),s(x,{class:"festival-booking-container",style:i({paddingTop:y.navPaddingTop+"px"})},{default:o((()=>[c(T,{title:"çº¿ä¸‹å£®ä¹¡è‰ºæœ¯èŠ‚é¢„çº¦",gradient:"linear-gradient(120deg, #e65100 0%, #ff9800 45%, #ffb74d 100%)"}),y.loading?(r(),s(x,{key:0,class:"loading"},{default:o((()=>[c(w,null,{default:o((()=>[d("åŠ è½½ä¸­...")])),_:1})])),_:1})):y.festivals.length>0?(r(),s(x,{key:1,class:"festival-list"},{default:o((()=>[(r(!0),f(u,null,m(y.festivals,(a=>(r(),s(x,{key:a.id,class:"festival-card"},{default:o((()=>[c(V,{src:a.image,class:"festival-cover",mode:"aspectFill"},null,8,["src"]),c(x,{class:"festival-content"},{default:o((()=>[c(w,{class:"festival-title"},{default:o((()=>[d(p(a.title),1)])),_:2},1024),c(w,{class:"festival-desc"},{default:o((()=>[d(p(a.description),1)])),_:2},1024),c(x,{class:"festival-info"},{default:o((()=>[c(x,{class:"info-item"},{default:o((()=>[c(w,{class:"info-icon"},{default:o((()=>[d("ðŸ“…")])),_:1}),c(w,{class:"info-text"},{default:o((()=>[d(p(a.date)+" "+p(a.time),1)])),_:2},1024)])),_:2},1024),c(x,{class:"info-item"},{default:o((()=>[c(w,{class:"info-icon"},{default:o((()=>[d("ðŸ“")])),_:1}),c(w,{class:"info-text"},{default:o((()=>[d(p(a.location),1)])),_:2},1024)])),_:2},1024),c(x,{class:"info-item"},{default:o((()=>[c(w,{class:"info-icon"},{default:o((()=>[d("ðŸ‘¥")])),_:1}),c(w,{class:h(["info-text",{"sold-out":0===a.availableSlots}])},{default:o((()=>[d(p(0===a.availableSlots?"å·²æ»¡":`å‰©ä½™ ${a.availableSlots} ä¸ªåé¢`),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024),c(E,{class:h(["book-btn",{disabled:0===a.availableSlots}]),disabled:0===a.availableSlots,onClick:e=>B.openBookingForm(a)},{default:o((()=>[d(p(0===a.availableSlots?"å·²æ»¡":"ç«‹å³é¢„çº¦"),1)])),_:2},1032,["class","disabled","onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(r(),s(x,{key:2,class:"empty-state"},{default:o((()=>[c(w,{class:"empty-icon"},{default:o((()=>[d("ðŸŽ­")])),_:1}),c(w,{class:"empty-text"},{default:o((()=>[d("æš‚æ— è‰ºæœ¯èŠ‚æ´»åŠ¨")])),_:1})])),_:1})),y.showBookingForm?(r(),s(x,{key:3,class:"booking-modal",onClick:v(B.closeBookingForm,["self"])},{default:o((()=>[c(x,{class:"modal-content"},{default:o((()=>[c(x,{class:"modal-header"},{default:o((()=>[c(w,{class:"modal-title"},{default:o((()=>[d("é¢„çº¦ä¿¡æ¯")])),_:1}),c(w,{class:"close-btn",onClick:B.closeBookingForm},{default:o((()=>[d("Ã—")])),_:1},8,["onClick"])])),_:1}),y.selectedFestival?(r(),s(x,{key:0,class:"selected-festival-info"},{default:o((()=>[c(w,{class:"festival-name"},{default:o((()=>[d(p(y.selectedFestival.title),1)])),_:1}),c(w,{class:"festival-datetime"},{default:o((()=>[d(p(y.selectedFestival.date)+" "+p(y.selectedFestival.time),1)])),_:1}),c(w,{class:"festival-place"},{default:o((()=>[d(p(y.selectedFestival.location),1)])),_:1})])),_:1})):_("",!0),c(x,{class:"form-group"},{default:o((()=>[c(w,{class:"form-label"},{default:o((()=>[d("å§“å "),c(w,{class:"required"},{default:o((()=>[d("*")])),_:1})])),_:1}),c(S,{class:h(["form-input",{error:y.formErrors.name}]),modelValue:y.formData.name,"onUpdate:modelValue":e[0]||(e[0]=a=>y.formData.name=a),placeholder:"è¯·è¾“å…¥æ‚¨çš„å§“å"},null,8,["class","modelValue"]),y.formErrors.name?(r(),s(w,{key:0,class:"error-text"},{default:o((()=>[d(p(y.formErrors.name),1)])),_:1})):_("",!0)])),_:1}),c(x,{class:"form-group"},{default:o((()=>[c(w,{class:"form-label"},{default:o((()=>[d("æ‰‹æœºå· "),c(w,{class:"required"},{default:o((()=>[d("*")])),_:1})])),_:1}),c(S,{class:h(["form-input",{error:y.formErrors.phone}]),modelValue:y.formData.phone,"onUpdate:modelValue":e[1]||(e[1]=a=>y.formData.phone=a),type:"number",placeholder:"è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·"},null,8,["class","modelValue"]),y.formErrors.phone?(r(),s(w,{key:0,class:"error-text"},{default:o((()=>[d(p(y.formErrors.phone),1)])),_:1})):_("",!0)])),_:1}),c(x,{class:"form-group"},{default:o((()=>[c(w,{class:"form-label"},{default:o((()=>[d("å‚ä¸Žäººæ•°")])),_:1}),c(S,{class:"form-input",modelValue:y.formData.participants,"onUpdate:modelValue":e[2]||(e[2]=a=>y.formData.participants=a),type:"number",placeholder:"é»˜è®¤1äºº"},null,8,["modelValue"])])),_:1}),c(x,{class:"form-group"},{default:o((()=>[c(w,{class:"form-label"},{default:o((()=>[d("å¤‡æ³¨")])),_:1}),c(j,{class:"form-textarea",modelValue:y.formData.remark,"onUpdate:modelValue":e[3]||(e[3]=a=>y.formData.remark=a),placeholder:"å¦‚æœ‰ç‰¹æ®Šéœ€æ±‚è¯·å¤‡æ³¨"},null,8,["modelValue"])])),_:1}),c(E,{class:"submit-btn",onClick:B.submitBooking},{default:o((()=>[d("ç¡®è®¤é¢„çº¦")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["onClick"])):_("",!0),y.showConfirmation?(r(),s(x,{key:4,class:"booking-modal",onClick:v(B.closeConfirmation,["self"])},{default:o((()=>[c(x,{class:"modal-content confirmation-modal"},{default:o((()=>[c(x,{class:"success-icon"},{default:o((()=>[d("âœ“")])),_:1}),c(w,{class:"success-title"},{default:o((()=>[d("é¢„çº¦æˆåŠŸ")])),_:1}),c(x,{class:"confirmation-details"},{default:o((()=>[c(x,{class:"detail-item"},{default:o((()=>[c(w,{class:"detail-label"},{default:o((()=>[d("æ´»åŠ¨åç§°")])),_:1}),c(w,{class:"detail-value"},{default:o((()=>[d(p(y.confirmationData.festivalTitle),1)])),_:1})])),_:1}),c(x,{class:"detail-item"},{default:o((()=>[c(w,{class:"detail-label"},{default:o((()=>[d("æ´»åŠ¨æ—¶é—´")])),_:1}),c(w,{class:"detail-value"},{default:o((()=>[d(p(y.confirmationData.festivalDate)+" "+p(y.confirmationData.festivalTime),1)])),_:1})])),_:1}),c(x,{class:"detail-item"},{default:o((()=>[c(w,{class:"detail-label"},{default:o((()=>[d("æ´»åŠ¨åœ°ç‚¹")])),_:1}),c(w,{class:"detail-value"},{default:o((()=>[d(p(y.confirmationData.festivalLocation),1)])),_:1})])),_:1}),c(x,{class:"detail-item"},{default:o((()=>[c(w,{class:"detail-label"},{default:o((()=>[d("é¢„çº¦äºº")])),_:1}),c(w,{class:"detail-value"},{default:o((()=>[d(p(y.confirmationData.name),1)])),_:1})])),_:1}),c(x,{class:"detail-item"},{default:o((()=>[c(w,{class:"detail-label"},{default:o((()=>[d("è”ç³»ç”µè¯")])),_:1}),c(w,{class:"detail-value"},{default:o((()=>[d(p(y.confirmationData.phone),1)])),_:1})])),_:1}),c(x,{class:"detail-item"},{default:o((()=>[c(w,{class:"detail-label"},{default:o((()=>[d("å‚ä¸Žäººæ•°")])),_:1}),c(w,{class:"detail-value"},{default:o((()=>[d(p(y.confirmationData.participants)+"äºº",1)])),_:1})])),_:1})])),_:1}),c(x,{class:"confirmation-actions"},{default:o((()=>[c(E,{class:"view-records-btn",onClick:B.goToRecordsFromConfirm},{default:o((()=>[d("æŸ¥çœ‹æˆ‘çš„é¢„çº¦")])),_:1},8,["onClick"]),c(E,{class:"close-confirm-btn",onClick:B.closeConfirmation},{default:o((()=>[d("è¿”å›žæ´»åŠ¨åˆ—è¡¨")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["onClick"])):_("",!0)])),_:1},8,["style"])}],["__scopeId","data-v-e048a0df"]]);export{T as default};
