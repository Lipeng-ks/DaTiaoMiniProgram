{"version":3,"file":"audio.service.js","sources":["services/audio.service.js"],"sourcesContent":["/**\r\n * AudioService - 音频服务\r\n * 负责音频播放和录音功能\r\n */\r\n\r\nlet innerAudioContext = null\r\nlet recorderManager = null\r\n\r\n/**\r\n * 初始化音频上下文\r\n */\r\nfunction initAudioContext() {\r\n  if (!innerAudioContext) {\r\n    innerAudioContext = uni.createInnerAudioContext()\r\n    \r\n    innerAudioContext.onError((err) => {\r\n      console.error('Audio error:', err)\r\n    })\r\n  }\r\n  return innerAudioContext\r\n}\r\n\r\n/**\r\n * 初始化录音管理器\r\n */\r\nfunction initRecorderManager() {\r\n  if (!recorderManager) {\r\n    recorderManager = uni.getRecorderManager()\r\n  }\r\n  return recorderManager\r\n}\r\n\r\n/**\r\n * 播放背景音乐\r\n * @param {string} url - 音频URL\r\n */\r\nexport function playBgm(url) {\r\n  const audio = initAudioContext()\r\n  audio.src = url\r\n  audio.play()\r\n}\r\n\r\n/**\r\n * 暂停播放\r\n */\r\nexport function pause() {\r\n  if (innerAudioContext) {\r\n    innerAudioContext.pause()\r\n  }\r\n}\r\n\r\n/**\r\n * 停止播放\r\n */\r\nexport function stop() {\r\n  if (innerAudioContext) {\r\n    innerAudioContext.stop()\r\n  }\r\n}\r\n\r\n/**\r\n * 恢复播放\r\n */\r\nexport function resume() {\r\n  if (innerAudioContext) {\r\n    innerAudioContext.play()\r\n  }\r\n}\r\n\r\n/**\r\n * 设置播放进度\r\n * @param {number} position - 播放位置（秒）\r\n */\r\nexport function seek(position) {\r\n  if (innerAudioContext) {\r\n    innerAudioContext.seek(position)\r\n  }\r\n}\r\n\r\n/**\r\n * 获取当前播放时间\r\n * @returns {number}\r\n */\r\nexport function getCurrentTime() {\r\n  return innerAudioContext ? innerAudioContext.currentTime : 0\r\n}\r\n\r\n/**\r\n * 获取音频总时长\r\n * @returns {number}\r\n */\r\nexport function getDuration() {\r\n  return innerAudioContext ? innerAudioContext.duration : 0\r\n}\r\n\r\n/**\r\n * 监听播放事件\r\n * @param {string} event - 事件名称\r\n * @param {Function} callback - 回调函数\r\n */\r\nexport function onAudioEvent(event, callback) {\r\n  if (!innerAudioContext) {\r\n    initAudioContext()\r\n  }\r\n  \r\n  switch (event) {\r\n    case 'play':\r\n      innerAudioContext.onPlay(callback)\r\n      break\r\n    case 'pause':\r\n      innerAudioContext.onPause(callback)\r\n      break\r\n    case 'stop':\r\n      innerAudioContext.onStop(callback)\r\n      break\r\n    case 'ended':\r\n      innerAudioContext.onEnded(callback)\r\n      break\r\n    case 'timeUpdate':\r\n      innerAudioContext.onTimeUpdate(callback)\r\n      break\r\n    case 'error':\r\n      innerAudioContext.onError(callback)\r\n      break\r\n  }\r\n}\r\n\r\n/**\r\n * 开始录音\r\n * @returns {Promise<void>}\r\n */\r\nexport function startRecord() {\r\n  return new Promise((resolve, reject) => {\r\n    const recorder = initRecorderManager()\r\n    \r\n    recorder.onStart(() => {\r\n      resolve()\r\n    })\r\n    \r\n    recorder.onError((err) => {\r\n      console.error('Recorder error:', err)\r\n      reject(err)\r\n    })\r\n    \r\n    recorder.start({\r\n      duration: 600000, // 最长10分钟\r\n      sampleRate: 44100,\r\n      numberOfChannels: 1,\r\n      encodeBitRate: 128000,\r\n      format: 'mp3'\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * 停止录音\r\n * @returns {Promise<Object>} RecordResult\r\n */\r\nexport function stopRecord() {\r\n  return new Promise((resolve, reject) => {\r\n    const recorder = initRecorderManager()\r\n    \r\n    recorder.onStop((res) => {\r\n      resolve({\r\n        tempFilePath: res.tempFilePath,\r\n        duration: Math.round(res.duration / 1000) // 转换为秒\r\n      })\r\n    })\r\n    \r\n    recorder.onError((err) => {\r\n      reject(err)\r\n    })\r\n    \r\n    recorder.stop()\r\n  })\r\n}\r\n\r\n/**\r\n * 播放录音\r\n * @param {string} path - 录音文件路径\r\n */\r\nexport function playRecord(path) {\r\n  const audio = initAudioContext()\r\n  audio.src = path\r\n  audio.play()\r\n}\r\n\r\n/**\r\n * 监听录音事件\r\n * @param {string} event - 事件名称\r\n * @param {Function} callback - 回调函数\r\n */\r\nexport function onRecordEvent(event, callback) {\r\n  const recorder = initRecorderManager()\r\n  \r\n  switch (event) {\r\n    case 'start':\r\n      recorder.onStart(callback)\r\n      break\r\n    case 'stop':\r\n      recorder.onStop(callback)\r\n      break\r\n    case 'pause':\r\n      recorder.onPause(callback)\r\n      break\r\n    case 'resume':\r\n      recorder.onResume(callback)\r\n      break\r\n    case 'error':\r\n      recorder.onError(callback)\r\n      break\r\n    case 'frameRecorded':\r\n      recorder.onFrameRecorded(callback)\r\n      break\r\n  }\r\n}\r\n\r\n/**\r\n * 销毁音频上下文\r\n */\r\nexport function destroy() {\r\n  if (innerAudioContext) {\r\n    innerAudioContext.destroy()\r\n    innerAudioContext = null\r\n  }\r\n}\r\n\r\nexport default {\r\n  playBgm,\r\n  pause,\r\n  stop,\r\n  resume,\r\n  seek,\r\n  getCurrentTime,\r\n  getDuration,\r\n  onAudioEvent,\r\n  startRecord,\r\n  stopRecord,\r\n  playRecord,\r\n  onRecordEvent,\r\n  destroy\r\n}\r\n"],"names":["uni"],"mappings":"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"}